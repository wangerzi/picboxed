/*!
 * jQuery.picboxed插件，用于放大图片，适用于各种需要对图片进行全屏放大操作的地方。
 *
 * Author:Jeffrey Wang
 *
 * Version:v1.1.4
 *
 * Usage: <img class="picboxed" src="..." data-header="头部信息" data-footer="尾部信息" >，动态添加图片时需要自行初始化：$(...).picboxed();
 *
 * Info: 灵感来源materialze的materiabox插件，但在实际部署中遇到了一些问题，于是就重写了，不依赖除jQuery以外的其他库。
 */
(function(a){a.fn.picboxed=function(){return this.each(function(){origin=a(this);if(origin.is(".initialized")){return}origin.addClass("initialized");origin.on("click",function(){origin=a(this);screenWidth=window.innerWidth;screenHeight=window.innerHeight;item=origin.parents(".carousel-item:first");if(item.length&&!item.is(".active")){return}oldWidth=origin.width();oldHeight=origin.height();newWidth=screenWidth*0.8;newHeight=newWidth*oldHeight/oldWidth;if(newHeight>screenHeight){newHeight=screenHeight*0.8;newWidth=newHeight*(oldWidth/oldHeight)}header=origin.attr("data-header");footer=origin.attr("data-footer");header=typeof header=="undefined"?"":header;footer=typeof footer=="undefined"?"":footer;wrap='<div class="img-wrap"></a>';d=a("<div></div>").addClass("picboxed-override").css({width:screenWidth,height:screenHeight,}).append('<div class="img-header">'+header+"</div>").append(origin.clone().css({width:oldWidth,height:oldHeight,top:origin.offset().top-a(document).scrollTop(),left:origin.offset().left})).append('<div class="img-footer">'+footer+"</div>").click(function(){b()});clone=a("body").append(d).find("img.picboxed:last");clone.wrap(wrap).addClass("active").animate({width:newWidth,height:newHeight,top:(screenHeight-newHeight)/2,left:(screenWidth-newWidth)/2,},"slow");var d=a("body .picboxed-override:last");if(document.addEventListener){document.addEventListener("DOMMouseScroll",c,false)}window.onmousewheel=document.onmousewheel=c});var c=function(i){i.preventDefault();if(i.wheelDelta){var n=-i.wheelDelta}else{if(i.detail){var n=-i.detail*40}}var l=clone.width();var f=clone.height();var k=parseInt(clone.css("top"));var m=parseInt(clone.css("left"));var h=l-2*n;var j=f*h/l;var g=i.screenX;var d=i.screenY;g=g<m?m:g;d=d<k?k:d;g=g>l+m?l+m:g;d=d>f+k?f+k:d;slideTop=(screenHeight-j)/2+screenHeight/2-d;slideLeft=(screenWidth-h)/2+screenWidth/2-g;if(h>screenWidth+400&&j>screenHeight+400||h<100&&j<100){return}clone.stop(true,false).animate({width:h,height:j,top:slideTop,left:slideLeft,},"fast")};function b(){override=a("body .picboxed-override:last");clone=override.find("img.picboxed");if(document.removeEventListener){document.removeEventListener("DOMMouseScroll",c,false)}window.onmousewheel=document.onmousewheel=function(){};var e=origin.offset().top-a(document).scrollTop();var d=origin.offset().left;console.log(e+":"+d);e=e==-a(document).scrollTop()?(screenHeight-oldHeight)/2:e;d=d==0?(screenWidth-oldWidth)/2:d;clone.animate({width:oldWidth,height:oldHeight,top:e,left:d,},"normal",function(){override.remove();origin.removeClass("active")})}})};a(document).ready(function(){a(".picboxed").picboxed()})}(jQuery));